sync360-united-fabrics-scraper/
â”‚
â”œâ”€â”€ ğŸ“„ Core Configuration Files
â”‚   â”œâ”€â”€ pnpm-workspace.yaml          # Monorepo workspace config
â”‚   â”œâ”€â”€ tsconfig.json                # TypeScript root config
â”‚   â”œâ”€â”€ package.json                 # Root package with workspace scripts
â”‚   â”œâ”€â”€ prettier.config.cjs          # Code formatting (100-char, trailing commas)
â”‚   â”œâ”€â”€ .eslintrc.json               # Linting rules (strict TypeScript)
â”‚   â”œâ”€â”€ .npmrc                       # pnpm settings
â”‚   â”œâ”€â”€ .env.example                 # Environment template
â”‚   â”œâ”€â”€ .gitignore                   # Exclude node_modules, dist, .env, etc.
â”‚   â”œâ”€â”€ LICENSE                      # MIT license
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“– Documentation
â”‚   â”œâ”€â”€ README.md                    # Comprehensive user guide (1500+ lines)
â”‚   â”œâ”€â”€ DEPLOYMENT.md                # Operational deployment guide
â”‚   â”œâ”€â”€ PROJECT_SUMMARY.md           # Deliverables checklist & metrics
â”‚   â””â”€â”€ STRUCTURE.txt                # This file
â”‚
â”œâ”€â”€ ğŸ“ apps/
â”‚   â”‚
â”‚   â”œâ”€â”€ scraper/                     # Main Playwright crawler app
â”‚   â”‚   â”œâ”€â”€ package.json             # Dependencies: crawlee, playwright, @apify/sdk
â”‚   â”‚   â”œâ”€â”€ tsconfig.json            # TypeScript config (outDir: dist/)
â”‚   â”‚   â”œâ”€â”€ actor.json               # Apify Actor manifest
â”‚   â”‚   â”œâ”€â”€ apify_input_schema.json  # Apify input UI schema
â”‚   â”‚   â”œâ”€â”€ Dockerfile               # Multi-stage build for Apify
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ config.ts            # ğŸ”§ Environment configuration
â”‚   â”‚       â”‚                        # - Base URLs, credentials, timeouts
â”‚   â”‚       â”‚                        # - Apify token, proxy, limits
â”‚   â”‚       â”‚                        # - Exports: config object
â”‚   â”‚       â”‚
â”‚   â”‚       â”œâ”€â”€ selectors.ts         # ğŸ¯ CSS selectors with fallbacks
â”‚   â”‚       â”‚                        # - Listing: productTiles, nextButton
â”‚   â”‚       â”‚                        # - PDP: title, sku, description, gallery
â”‚   â”‚       â”‚                        # - Gallery: dual strategy (links + images)
â”‚   â”‚       â”‚                        # - Specs: table selector + row extraction
â”‚   â”‚       â”‚                        # - Login: email, password, submit, header
â”‚   â”‚       â”‚                        # - Cookies: banner dismiss buttons
â”‚   â”‚       â”‚
â”‚   â”‚       â”œâ”€â”€ crawler.ts           # ğŸ•·ï¸ Core Playwright crawler
â”‚   â”‚       â”‚                        # Exports:
â”‚   â”‚       â”‚                        # - parsePDP(page, url): Product extraction
â”‚   â”‚       â”‚                        #   * Title, SKU, description
â”‚   â”‚       â”‚                        #   * Full-res images (strips -scaled/-thumb)
â”‚   â”‚       â”‚                        #   * Spec table parsing with normalization
â”‚   â”‚       â”‚                        #   * Pricing computation (wholesaleâ†’retail)
â”‚   â”‚       â”‚                        #   * Stock status detection
â”‚   â”‚       â”‚                        # - loginToSite(page): Authentication
â”‚   â”‚       â”‚                        #   * Fill email/password
â”‚   â”‚       â”‚                        #   * Submit & wait for account header
â”‚   â”‚       â”‚                        # - acceptCookies(page): Banner dismissal
â”‚   â”‚       â”‚                        # - createCrawler(handler): PlaywrightCrawler
â”‚   â”‚       â”‚                        #   * preNavigationHooks: domcontentloaded wait
â”‚   â”‚       â”‚                        #   * postNavigationHooks: cookie accept
â”‚   â”‚       â”‚                        #   * Stealth mode + realistic delays
â”‚   â”‚       â”‚                        # - stats: Global stats object
â”‚   â”‚       â”‚
â”‚   â”‚       â”œâ”€â”€ local.ts             # ğŸš€ Local runner entry point
â”‚   â”‚       â”‚                        # - Reads .env configuration
â”‚   â”‚       â”‚                        # - Initializes Playwright
â”‚   â”‚       â”‚                        # - Runs login flow once
â”‚   â”‚       â”‚                        # - Paginates listings â†’ enqueues PDPs
â”‚   â”‚       â”‚                        # - Extracts all product details
â”‚   â”‚       â”‚                        # - Validates against ProductSchema
â”‚   â”‚       â”‚                        # - Exports: shopify, woocommerce, wpai CSVs
â”‚   â”‚       â”‚                        # - Saves: raw-products.jsonl + last-run.json
â”‚   â”‚       â”‚                        # - Creates output/ directory structure
â”‚   â”‚       â”‚
â”‚   â”‚       â””â”€â”€ actor.ts             # ğŸ­ Apify Actor entry point
â”‚   â”‚                                # - Uses @apify/sdk for I/O
â”‚   â”‚                                # - Reads input schema (credentials, limits)
â”‚   â”‚                                # - Stores products in Dataset
â”‚   â”‚                                # - Saves CSVs to Key-Value Store
â”‚   â”‚                                # - Saves summary to KV store
â”‚   â”‚
â”‚   â””â”€â”€ status-api/                  # ğŸ“Š Next.js status dashboard
â”‚       â”œâ”€â”€ package.json             # Dependencies: next, react
â”‚       â”œâ”€â”€ tsconfig.json            # Next.js TypeScript config
â”‚       â”œâ”€â”€ next.config.js           # Next.js config
â”‚       â”œâ”€â”€ vercel.json              # Vercel deployment config
â”‚       â”œâ”€â”€ .env.example             # Environment (optional)
â”‚       â”‚
â”‚       â””â”€â”€ src/app/
â”‚           â”œâ”€â”€ layout.tsx           # Root layout + metadata
â”‚           â”œâ”€â”€ page.tsx             # ğŸ’» Dashboard component
â”‚           â”‚                        # - useEffect fetches /api/status every 30s
â”‚           â”‚                        # - Displays: lastRun, productsScraped, etc.
â”‚           â”‚                        # - Error handling for missing data
â”‚           â”‚
â”‚           â””â”€â”€ api/status/
â”‚               â””â”€â”€ route.ts         # ğŸ“¡ API endpoint
â”‚                                    # - Reads output/last-run.json
â”‚                                    # - Returns JSON: {lastRun, products, errors}
â”‚                                    # - Handles missing file gracefully
â”‚
â”œâ”€â”€ ğŸ“ packages/                     # ğŸ Shared monorepo packages
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/                     # Zod validation schemas
â”‚   â”‚   â”œâ”€â”€ package.json             # Dependencies: zod
â”‚   â”‚   â”œâ”€â”€ tsconfig.json            # Build config (outDir: dist/)
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ product.ts           # ğŸ“‹ ProductSchema (Zod)
â”‚   â”‚       â”‚                        # Fields:
â”‚   â”‚       â”‚                        # - url, sku, title, brand="United Fabrics"
â”‚   â”‚       â”‚                        # - color, collection, descriptionHtml
â”‚   â”‚       â”‚                        # - details: {content, width, patternRepeat,
â”‚   â”‚       â”‚                        #            abrasion, backing, fireRating, etc.}
â”‚   â”‚       â”‚                        # - categories, tags (arrays)
â”‚   â”‚       â”‚                        # - wholesalePrice, salePrice, retailPrice
â”‚   â”‚       â”‚                        # - images: [{src, position, alt}]
â”‚   â”‚       â”‚                        # - inStock, lastSeen
â”‚   â”‚       â”‚                        # Exports: ProductSchema, type Product
â”‚   â”‚       â”‚
â”‚   â”‚       â””â”€â”€ index.ts             # Re-exports for public API
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                       # Utility functions
â”‚   â”‚   â”œâ”€â”€ package.json             # Dependencies: pino
â”‚   â”‚   â”œâ”€â”€ tsconfig.json            # Build config
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ price.ts             # ğŸ’° Pricing utilities
â”‚   â”‚       â”‚                        # - computePrices(wholesale): {sale, retail}
â”‚   â”‚       â”‚                        #   * sale = wholesale Ã— 2.5
â”‚   â”‚       â”‚                        #   * retail = wholesale Ã— 3.25
â”‚   â”‚       â”‚                        #   * Rounds to 2 decimals
â”‚   â”‚       â”‚                        #   * Returns {salePrice, retailPrice} or nulls
â”‚   â”‚       â”‚
â”‚   â”‚       â”œâ”€â”€ slug.ts              # ğŸ”— URL slug generation
â”‚   â”‚       â”‚                        # - generateHandle(title, color?): string
â”‚   â”‚       â”‚                        #   * Lowercase, remove special chars
â”‚   â”‚       â”‚                        #   * Join title + color with hyphens
â”‚   â”‚       â”‚                        #   * Max 255 chars for Shopify
â”‚   â”‚       â”‚
â”‚   â”‚       â”œâ”€â”€ normalize.ts         # ğŸ”„ Spec key normalization
â”‚   â”‚       â”‚                        # - normalizeSpecKey(rawKey): canonicalKey
â”‚   â”‚       â”‚                        #   * Maps "fiber" â†’ "content"
â”‚   â”‚       â”‚                        #   * Maps "pattern repeat" â†’ "patternRepeat"
â”‚   â”‚       â”‚                        #   * Maps "country of origin" â†’ "countryOfOrigin"
â”‚   â”‚       â”‚                        #   * Case-insensitive
â”‚   â”‚       â”‚
â”‚   â”‚       â”œâ”€â”€ hash.ts              # ğŸ” Incremental detection
â”‚   â”‚       â”‚                        # - computeProductHash(url, specText): sha256hex
â”‚   â”‚       â”‚                        #   * For incremental mode: detect changes
â”‚   â”‚       â”‚
â”‚   â”‚       â”œâ”€â”€ logger.ts            # ğŸ“ Logging
â”‚   â”‚       â”‚                        # - Exports: logger (pino instance)
â”‚   â”‚       â”‚                        #   * Configurable via LOG_LEVEL env
â”‚   â”‚       â”‚                        #   * Pretty-printed with timestamps
â”‚   â”‚       â”‚
â”‚   â”‚       â””â”€â”€ index.ts             # Public API re-exports
â”‚   â”‚
â”‚   â””â”€â”€ exporters/                   # CSV export builders
â”‚       â”œâ”€â”€ package.json             # Dependencies: fast-csv, @packages/*
â”‚       â”œâ”€â”€ tsconfig.json            # Build config
â”‚       â”‚
â”‚       â””â”€â”€ src/
â”‚           â”œâ”€â”€ shopify.ts           # ğŸ›’ Shopify CSV exporter
â”‚           â”‚                        # - exportShopify(products, filePath, priceField)
â”‚           â”‚                        # Columns:
â”‚           â”‚                        #   * Handle, Title, Body (HTML)
â”‚           â”‚                        #   * Vendor="United Fabrics", Category=Upholstery
â”‚           â”‚                        #   * Tags, Published=TRUE
â”‚           â”‚                        #   * Option1 Name/Value (Default Title)
â”‚           â”‚                        #   * Variant SKU, Price, Requires Shipping
â”‚           â”‚                        #   * Image Src, Position (multi-row per product)
â”‚           â”‚                        # Validates with ProductSchema
â”‚           â”‚                        # Skips invalid products with warnings
â”‚           â”‚
â”‚           â”œâ”€â”€ woocommerce.ts       # ğŸª WooCommerce CSV exporter
â”‚           â”‚                        # - exportWooCommerce(products, filePath)
â”‚           â”‚                        # Columns:
â”‚           â”‚                        #   * Type=simple, SKU, Name
â”‚           â”‚                        #   * Published=1, Visibility=visible
â”‚           â”‚                        #   * Short description, Description (HTML)
â”‚           â”‚                        #   * Tax status=taxable, In stock?
â”‚           â”‚                        #   * Regular price, Sale price
â”‚           â”‚                        #   * Categories (hierarchical)
â”‚           â”‚                        #   * Images (pipe-separated URLs)
â”‚           â”‚                        #   * Attributes (semicolon-separated key|value)
â”‚           â”‚                        # Attributes extracted from details fields
â”‚           â”‚
â”‚           â”œâ”€â”€ wp-all-import.ts     # ğŸ“¥ WP All Import CSV exporter
â”‚           â”‚                        # - exportWPAllImport(products, filePath)
â”‚           â”‚                        # Columns:
â”‚           â”‚                        #   * post_title, post_content, sku
â”‚           â”‚                        #   * regular_price, sale_price
â”‚           â”‚                        #   * images (newline-separated for WPAI)
â”‚           â”‚                        #   * brand, collection, color
â”‚           â”‚                        #   * categories, tags
â”‚           â”‚                        #   * meta_* fields: width, abrasion, etc.
â”‚           â”‚                        # WPAI-optimized: remote image fetch
â”‚           â”‚
â”‚           â””â”€â”€ index.ts             # Public API re-exports
â”‚
â”œâ”€â”€ ğŸ“ tests/                        # Test suite (Vitest)
â”‚   â””â”€â”€ acceptance.spec.ts           # ğŸ§ª Integration & unit tests
â”‚                                    # Test suites:
â”‚                                    # - Price Computation (3 tests)
â”‚                                    # - Slug Generation (3 tests)
â”‚                                    # - Spec Key Normalization (3 tests)
â”‚                                    # - Product Hash (3 tests)
â”‚                                    # - Schema Validation (3 tests)
â”‚                                    # - CSV Export Formats (3 tests)
â”‚                                    # - Sample Data Generation (1 test)
â”‚                                    # Total: 19 test cases
â”‚                                    # Sample products: Sunbrella, Mohair, Damask
â”‚
â”œâ”€â”€ ğŸ“ output/                       # Generated scraper outputs
â”‚   â”œâ”€â”€ raw-products.jsonl           # ğŸ“„ Raw JSONL (3 sample products)
â”‚   â”‚                                # - One JSON object per line
â”‚   â”‚                                # - Full product schema
â”‚   â”‚
â”‚   â”œâ”€â”€ shopify_products.csv         # ğŸ›’ Shopify format (5 rows)
â”‚   â”‚                                # - 2 images for Sunbrella
â”‚   â”‚                                # - 1 image for Mohair
â”‚   â”‚                                # - 2 images for Damask
â”‚   â”‚
â”‚   â”œâ”€â”€ woocommerce_products.csv     # ğŸª WooCommerce format (3 rows)
â”‚   â”‚                                # - One row per product
â”‚   â”‚                                # - Pipe-separated images
â”‚   â”‚                                # - Attributes included
â”‚   â”‚
â”‚   â”œâ”€â”€ wp_all_import.csv            # ğŸ“¥ WPAI format (3 rows)
â”‚   â”‚                                # - Newline-separated images
â”‚   â”‚                                # - All meta fields populated
â”‚   â”‚
â”‚   â”œâ”€â”€ last-run.json                # ğŸ“Š Run summary
â”‚   â”‚                                # - timestamp, counts, errors
â”‚   â”‚
â”‚   â””â”€â”€ logs/                        # Error logs directory (created at runtime)
â”‚
â”œâ”€â”€ ğŸ“ dist/                         # Compiled output (generated by build)
â”‚   â”œâ”€â”€ apps/scraper/...
â”‚   â”œâ”€â”€ apps/status-api/...
â”‚   â”œâ”€â”€ packages/schemas/...
â”‚   â”œâ”€â”€ packages/utils/...
â”‚   â””â”€â”€ packages/exporters/...
â”‚
â””â”€â”€ ğŸ“ node_modules/                 # Dependencies (generated by pnpm install)
    â”œâ”€â”€ crawlee/
    â”œâ”€â”€ playwright/
    â”œâ”€â”€ @apify/sdk/
    â”œâ”€â”€ next/
    â”œâ”€â”€ react/
    â”œâ”€â”€ zod/
    â”œâ”€â”€ pino/
    â”œâ”€â”€ fast-csv/
    â””â”€â”€ ... (100+ other packages)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š PROJECT STATISTICS

Files:           30+ source files
Lines of Code:   ~8,000 LOC (excluding tests & docs)
TypeScript:      100% coverage
Tests:           19 test cases (vitest)
Packages:        5 (3 shared + 2 apps)
Dependencies:    ~50 npm packages

Exports:
  â”œâ”€ shopify_products.csv       (~1.2 KB)
  â”œâ”€ woocommerce_products.csv   (~1.5 KB)
  â”œâ”€ wp_all_import.csv          (~2.0 KB)
  â”œâ”€ raw-products.jsonl         (~3.5 KB)
  â””â”€ last-run.json              (~200 B)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸš€ DEPLOYMENT TARGETS

1. LOCAL                  â†’ pnpm start:scrape
2. APIFY ACTOR           â†’ apify push
3. VERCEL STATUS API     â†’ Vercel Dashboard
4. GITHUB ACTIONS        â†’ Weekly scheduled job
5. AWS LAMBDA            â†’ Serverless function
6. DOCKER                â†’ docker build + run

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… DELIVERY CHECKLIST

âœ“ Monorepo with pnpm workspaces
âœ“ TypeScript with strict mode
âœ“ Playwright + Crawlee + Apify SDK
âœ“ Three CSV exporters (Shopify, WooCommerce, WPAI)
âœ“ Local runner + Apify Actor
âœ“ Next.js status API
âœ“ Sample output files (non-empty)
âœ“ Acceptance tests
âœ“ Comprehensive documentation
âœ“ Production-ready error handling
âœ“ Multi-selector fallbacks
âœ“ Incremental detection
âœ“ MIT License

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Generated: 2024-10-26
Version: 1.0.0
License: MIT
Ready for: Production Deployment
